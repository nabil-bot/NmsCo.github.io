
 <!doctype html>
<html lang="bn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Study Progress ‚Äî Fullscreen Sheet</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bangla:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css" />

  <style>
    /* ========= Base ========= */
:root {
  --font: "Noto Sans Bangla", "Noto Sans Bengali", sans-serif;
  --bg: #f0f4f8;
  --card: #ffffff;
  --accent: #3b82f6;
  --danger: #ef4444;
  --muted: #64748b;
  --border: #d1d5db;
  --color-low: #fee2e2;
  --color-mid: #fef3c7;
  --color-high: #d1fae5;
  --color-full: #86efac;
  --font-base: 1rem;
  --font-small: 0.875rem;
  --font-large: 1.25rem;
}

* {
  box-sizing: border-box;
  font-family: var(--font);
  transition: background 0.15s, border 0.15s, color 0.15s;
}

html, body {
  height: 100%;
  margin: 0;
  background: var(--bg);
  color: #0f172a;
  font-size: var(--font-base);
}

/* ========= Topbar ========= */
.topbar {
  display: flex;
  flex-wrap: wrap;
  justify-content: space-between;
  align-items: center;
  padding: 0.75rem 1rem;
  background: linear-gradient(180deg, #ffffff, #f8fafc);
  border-bottom: 1px solid #e5e7eb;
  position: sticky;
  top: 0;
  z-index: 10;
  gap: 0.5rem;
}

.left-top, .right-top {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.title-input {
  padding: 0.5rem 0.75rem;
  font-size: var(--font-large);
  border-radius: 0.375rem;
  border: 1px solid #d1d5db;
  min-width: 12rem;
  flex: 1;
}

button {
  cursor: pointer;
  border: none;
  border-radius: 0.375rem;
  padding: 0.5rem 0.75rem;
  font-weight: 600;
  transition: transform 0.1s, background 0.2s;
}

button:hover {
  transform: translateY(-1px);
}

button.primary {
  background: var(--accent);
  color: #fff;
}

button.danger {
  background: #fee2e2;
  color: var(--danger);
}

button.small {
  font-size: var(--font-small);
  padding: 0.25rem 0.5rem;
}

.icon-btn {
  font-size: 1.125rem;
  line-height: 1;
  background: #eff6ff;
  color: var(--accent);
  padding: 0.375rem 0.5rem;
}

/* ========= Layout ========= */
.main-full {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  padding: 1rem;
  height: calc(100vh - 4rem);
  overflow: auto;
}

.subjects-container {
  overflow-y: auto;
  display: flex;
  flex-direction: column;
  gap: 1rem;
  flex: 1;
}

.card {
  background: var(--card);
  border-radius: 0.75rem;
  padding: 0.75rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
}

.overall-box {
  width: 100%;
  max-width: 100%;
}

/* ========= Subjects ========= */
.subject {
  padding: 0;
  overflow: visible;
}

.subject-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: #eff6ff;
  color: #111827;
}

.subject-header .left {
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.subject-header .right {
  display: flex;
  align-items: center;
  gap: 0.375rem;
}

.subject-name {
  font-size: var(--font-large);
  font-weight: 700;
  min-width: 7.5rem;
  border-bottom: 2px solid transparent;
}

.subject-name:focus {
  border-color: var(--accent);
  outline: none;
}

.subject-progress-wrap {
  background: #f1f5f9;
  height: 0.625rem;
  margin: 0.375rem 0.5rem 0.5rem;
  border-radius: 9999px;
  overflow: hidden;
}

.subject-progress-fill {
  height: 100%;
  width: 0%;
  background: var(--accent);
  border-radius: 9999px;
  transition: width 0.25s ease;
}

/* ========= Parts ========= */
.parts-row {
  display: flex;
  flex-direction: column;
  gap: 0.625rem;
  padding: 0.5rem;
}

.part-col {
  flex: 1;
  min-width: 100%;
  border: 1px solid var(--border);
  border-radius: 0.5rem;
  background: #f9fafb;
}

.part-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #f3f4f6;
  border-bottom: 1px solid var(--border);
  padding: 0.375rem 0.5rem;
}

.part-name {
  font-weight: 600;
  font-size: 0.9375rem;
}

.part-name:focus {
  outline: none;
  border-bottom: 2px solid var(--accent);
}

.part-actions {
  display: flex;
  gap: 0.375rem;
}

/* ========= Chapters ========= */
.chapters-list {
  display: flex;
  flex-direction: column;
  gap: 0.375rem;
  padding: 0.375rem;
}

.chapter-row {
  display: flex;
  align-items: center;
  gap: 0.375rem;
  border: 1px solid #e5e7eb;
  border-radius: 0.375rem;
  padding: 0.25rem 0.375rem;
  background: #fff;
}

.chapter-row input[type="checkbox"] {
  transform: scale(1.2);
}

.chap-name {
  flex: 1;
  font-weight: 500;
  border-bottom: 2px solid transparent;
}

.chap-name:focus {
  border-color: var(--accent);
  outline: none;
}

.chap-goal, .chap-solved {
  min-width: 4rem;
  text-align: center;
  font-size: var(--font-small);
  color: #334155;
  display: flex;
  align-items: center;
  gap: 0.5rem; /* Increased gap for spacing */
}

.goal-value, .solved-value {
  display: inline-block;
  min-width: 2rem;
  padding: 0.25rem 0.5rem;
  border: 1px solid #d1d5db;
  border-radius: 0.25rem;
  background: #f9fafb;
  text-align: center;
  /* user-select: none;  */
}

.solved-inc, .solved-dec {
  width: 2.5rem; /* Larger buttons */
  height: 2.5rem;
  line-height: 1;
  font-size: 1rem; /* Larger font for clarity */
  background: #e0e7ff;
  color: var(--accent);
  border-radius: 0.25rem;
  padding: 0.5rem; /* Larger touch target */
  display: flex;
  align-items: center;
  justify-content: center;
}

.solved-inc:hover, .solved-dec:hover {
  background: #dbeafe;
}

.chap-progress {
  flex: 1;
  min-width: 4rem;
  height: 0.5rem;
  background: #e5e7eb;
  border-radius: 9999px;
  position: relative;
  overflow: hidden;
}

.chap-progress .fill {
  height: 100%;
  border-radius: 9999px;
  transition: width 0.25s ease;
}

/* .chap-progress span {
  position: absolute;
  top: -1.125rem;
  right: 0.125rem;
  font-size: 0.6875rem;
  color: #475569;
} */

.chap-progress {
  position: relative;
  height: 0.75rem; /* slightly taller for better readability */
  border-radius: 9999px;
  overflow: hidden;
  background: #e5e7eb;
}




/* ========= Side Panel (Right) ========= */
.side-panel {
  display: flex;
  flex-direction: column;
  gap: 1rem;
  overflow-y: auto;
}

/* Cards in side panel */
.card h4 {
  margin-top: 0;
}

.big-pct {
  font-weight: 700;
  font-size: 1.375rem;
  color: var(--accent);
}

.progress-wrap {
  width: 100%;
  height: 0.625rem;
  background: #e2e8f0;
  border-radius: 9999px;
  overflow: hidden;
}

.progress-fill {
  height: 100%;
  border-radius: 9999px;
  transition: width 0.3s;
}

.overall-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.muted {
  color: var(--muted);
}

.small {
  font-size: var(--font-small);
}

/* ========= Settings Panel ========= */
.settings-panel {
  position: fixed;
  top: 0;
  right: -100%;
  width: 100%;
  max-width: 22.5rem;
  height: 100vh;
  background: var(--card);
  box-shadow: -2px 0 12px rgba(0, 0, 0, 0.1);
  transition: right 0.3s ease;
  display: flex;
  flex-direction: column;
  z-index: 999;
}

.settings-panel.open {
  right: 0;
}

.settings-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.875rem;
  border-bottom: 1px solid #e5e7eb;
  background: #f8fafc;
}

.settings-header h3 {
  margin: 0;
}

.settings-body {
  padding: 0.875rem;
  overflow-y: auto;
  flex: 1;
}

.setting-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 0.625rem;
}

.setting-row label {
  flex: 1;
  font-weight: 500;
}

.setting-row input[type="color"],
.setting-row select {
  flex-shrink: 0;
  margin-left: 0.5rem;
}

.empty-note {
  text-align: center;
  color: var(--muted);
  margin-top: 1.25rem;
}

::-webkit-scrollbar {
  width: 0.5rem;
}

::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 9999px;
}

::-webkit-scrollbar-thumb:hover {
  background: #94a3b8;
}

#saveIndicator {
  position: fixed;
  bottom: 1.25rem;
  right: 1.5rem;
  background: #1e293b;
  color: #fff;
  padding: 0.5rem 0.875rem;
  border-radius: 0.5rem;
  font-size: var(--font-small);
  opacity: 0;
  transform: translateY(0.625rem);
  transition: opacity 0.3s, transform 0.3s;
  pointer-events: none;
  z-index: 1000;
}

#saveIndicator.visible {
  opacity: 1;
  transform: translateY(0);
}

.subject-header .left {
  position: relative;
  display: flex;
  align-items: center;
  gap: 0.5rem;
}

.color-picker-wrap {
  position: relative;
  width: 0.75rem;
  height: 2rem;
  border-radius: 0.375rem;
  cursor: pointer;
  flex-shrink: 0;
}

.color-picker-wrap input[type="color"] {
  appearance: none;
  -webkit-appearance: none;
  border: none;
  width: 100%;
  height: 100%;
  padding: 0;
  margin: 0;
  cursor: pointer;
  background: none;
}

.color-picker-wrap:hover {
  transform: scaleX(1.2);
  filter: brightness(1.05);
  transition: all 0.2s ease;
}

/* ========= Media Queries for Responsiveness ========= */
@media (max-width: 768px) {
  .topbar {
    flex-direction: column;
    align-items: stretch;
    padding: 0.5rem;
  }

  .left-top, .right-top {
    justify-content: center;
  }

  #overallBox {
    margin: 0.5rem 0;
  }

  .title-input {
    min-width: auto;
  }

  .main-full {
    padding: 0.5rem;
  }

  .subjects-container {
    padding-right: 0;
  }

  button {
    padding: 0.625rem 1rem;
  }

  .icon-btn {
    padding: 0.5rem;
  }

  .settings-panel {
    width: 100%;
  }
}

@media (min-width: 769px) {
  .topbar {
    flex-wrap: nowrap;
  }

  .overall-box {
    flex: 1;
    min-width: 0;
  }

  .parts-row {
    flex-direction: row;
    flex-wrap: wrap;
  }

  .part-col {
    min-width: 16rem;
  }
}

@media (max-width: 480px) {
  :root {
    --font-base: 0.9375rem;
    --font-small: 0.8125rem;
    --font-large: 1.125rem;
  }

  /* Better spacing and readability for mobile */
  .chapters-list {
    gap: 0.625rem;
  }

  .chapter-row {
    display: grid;
    grid-template-columns: 1.75rem 1fr auto;
    grid-template-areas:
      "check name del"
      "goal solved solved"
      "prog prog prog";
    gap: 0.375rem;
    align-items: center;
    padding: 0.625rem 0.75rem;
    border: 1px solid #e2e8f0;
    border-radius: 0.625rem;
    background: #ffffff;
    box-shadow: 0 2px 4px rgba(15, 23, 42, 0.05);
  }

  /* More distinct look and spacing */
  .chapter-row:nth-child(odd) {
    background: #f8fafc;
  }

  .chap-check {
    grid-area: check;
    transform: scale(1.3);
    justify-self: center;
  }

  .chap-name {
    grid-area: name;
    font-weight: 600;
    font-size: 1rem;
    color: #0f172a;
    padding-left: 0.25rem;
    word-break: break-word;
  }

  .chap-goal {
    grid-area: goal;
    display: flex;
    align-items: center;
    justify-content: flex-start;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #334155;
    /* === NEW FIX === */
  position: relative; /* Required for z-index to work */
  z-index: 10;      /* Ensure this element is above all others in the row */
  /* ============= */
  }

  .chap-solved {
    grid-area: solved;
    display: flex;
    justify-content: flex-end;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    color: #334155;
  }

  .goal-value,
  .solved-value {
    padding: 0.5rem;
    border-radius: 0.375rem;
    background: #f1f5f9;
    border: 1px solid #cbd5e1;
    min-width: 2.5rem;
    text-align: center;
  }

  .solved-inc,
  .solved-dec {
    width: 2.5rem;
    height: 2.5rem;
    font-size: 1.125rem;
    font-weight: bold;
    background: #e0e7ff;
    color: var(--accent);
    border: 1px solid #c7d2fe;
    border-radius: 0.375rem;
    display: flex;
    justify-content: center;
    align-items: center;
  }

  .solved-inc:active,
  .solved-dec:active {
    background: #dbeafe;
  }

  .chap-progress {
    grid-area: prog;
    width: 100%;
    height: 0.625rem;
    background: #e2e8f0;
    border-radius: 9999px;
    overflow: hidden;
    /* margin-top: 0.25rem; */
    align-items: center;
    justify-content: center;
  }

  /* .chap-progress .fill {
    height: 100%;
    transition: width 0.3s ease;
    background: var(--accent);
  } */


  .chap-progress .fill {
  height: 100%;
  border-radius: 9999px;
  transition: width 0.25s ease;
  position: absolute;
  top: 0;
  left: 0;
}


  /* .chap-progress span {
    display: none; 
  } */

  .chap-progress span {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.6rem;
  font-weight: 500;
  color: #4c5770; /* dark text for contrast */
  text-shadow: 0 0 2px rgba(255,255,255,0.6); /* subtle for visibility */
  pointer-events: none;
}

  .chapter-row .del-ch {
    grid-area: del;
    justify-self: end;
    font-size: 1rem;
    color: var(--danger);
    background: none;
    padding: 0.25rem 0.5rem;
  }

  .part-col {
    border-radius: 0.75rem;
    padding: 0.375rem;
    background: #f9fafb;
  }

  .part-header {
    border-radius: 0.5rem;
    padding: 0.5rem;
    background: #e2e8f0;
  }

  .part-name {
    font-size: 1rem;
    font-weight: 700;
  }

  /* Increase tap area for adding/removing chapters */
  .part-actions button {
    padding: 0.625rem;
    font-size: 0.875rem;
  }
}


/* ========= Hide toolbar animation ========= */
.right-top {
  transition: transform 0.3s ease, opacity 0.3s ease;
}

.right-top.hide-toolbar {
  transform: translateY(-100%);
  opacity: 0;
  /* REMOVED: pointer-events: none; */
}


.hide-toolbar {
  transform: translateY(-100%);
  opacity: 0;
  transition: all 0.3s ease;
}


@media (max-width: 768px) {
  /* smooth transitions */
  .topbar {
    transition: height .22s ease, padding .22s ease, opacity .22s ease;
  }

  /* collapsed state reduces topbar size and hides title */
  .topbar.collapsed {
    padding: 6px 8px;
    height: 48px; /* adjust if you want it smaller/larger */
    overflow: visible;
  }

  /* hide the visible title input to free height */
  .topbar.collapsed .title-input {
    display: none;            /* remove title from layout so header gets smaller */
  }

  /* hide the right-top and overall-box */
  .right-top, #overallBox {
    transition: transform .22s ease, opacity .22s ease, height .22s ease, margin .22s ease, padding .22s ease;
  }
  .right-top.hide-toolbar, #overallBox.hide-toolbar {
    transform: translateY(-100%);
    opacity: 0;
    pointer-events: none;
    height: 0;
    margin: 0;
    padding: 0;
  }

  /* optional: keep the settings icon visible and aligned */
  .topbar .left-top { align-items: center; gap: 8px; }
}

/* ===== Scroll Hide (Mobile) ===== */
@media (max-width: 768px) {
  .topbar {
    transition: all 0.3s ease;
  }

  /* Collapsed topbar - smaller height */
  .topbar.collapsed {
    padding: 0.25rem 0.5rem;
    height: 3rem;
    overflow: hidden;
  }

  /* Hide unnecessary parts */
  .hide-toolbar {
    opacity: 0;
    transform: translateY(-100%);
    pointer-events: none;
    height: 0;
    margin: 0;
    padding: 0;
  }

  /* Show title clearly when others hidden */
  #titleInput.only-title {
    display: block !important;
    opacity: 1 !important;
    width: 100%;
    max-width: 90%;
    text-align: center;
    font-size: 1.15rem;
    font-weight: 600;
    border: none;
    background: transparent;
    box-shadow: none;
    outline: none;
  }

  /* Subtle fade-in/out */
  .topbar.collapsed #titleInput.only-title {
    transition: opacity 0.3s ease;
  }
}




/* ========= Swipe-to-Delete Styles ========= */
/* This ensures the content can be moved without affecting the row's boundaries */
.chapter-content {
  display: contents; 
  position: relative;
  /* Add z-index to ensure it sits on top when not swiped */
  z-index: 2; /* Set content higher than the button initially */
  transition: transform 0.3s ease-out;
  cursor: grab;
}

/* This is the class applied by JS when swiped */
.chapter-row.swiped .chapter-content {
  transform: translateX(-5rem); /* slides the content left */
}

/* Position and style the delete button for the swipe action */
.delete-swipe-btn {
  position: absolute;
  top: 0;
  right: 0;
  width: 5rem; 
  height: 100%;
  background-color: var(--danger);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  /* Reduce z-index to sit behind the content until revealed */
  z-index: 1; 
  border-radius: 0 0.375rem 0.375rem 0; 
  
  /* Hides the button by pushing it 100% of its width outside the row */
  transform: translateX(100%); 
  transition: transform 0.3s ease-out;
  /* REMOVE ALL OPACITY RULES */
}

.chapter-row.swiped .delete-swipe-btn {
  /* === FIX: Show when swiped === */
  opacity: 1;
  transform: translateX(0); /* Slide into view */
}

/* Ensure the chapter-row has a relative position for absolute positioning of the delete button */
.chapter-row {
  position: relative; 
  overflow: hidden;
  /* ... existing styles ... */
}


.delete-swipe-btn {
  position: absolute;
  top: 0;
  right: 0;
  width: 5rem; 
  height: 100%;
  background-color: var(--danger);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.5rem;
  font-weight: bold;
  cursor: pointer;
  z-index: 1; /* Keep it below the content layer */
  border-radius: 0 0.375rem 0.375rem 0; 
  
  /* === FIX 1: Start outside the row's boundary === */
  /* We use transform to keep it visually hidden to the right */
  transform: translateX(100%); 
  transition: transform 0.3s ease-out;
}

/* === FIX 2: Reveal the button when swiped === */
.chapter-row.swiped .delete-swipe-btn {
  transform: translateX(0); /* Slides the button into position */
}

/* Click animation */
.solved-inc.animate {
  animation: pop 0.3s forwards;
}

/* Keyframes for pop */
@keyframes pop {
  0% { transform: scale(1); }
  50% { transform: scale(1.4); }
  100% { transform: scale(1); }
}
  </style>


</head>
<body>
  <div id="app">
    <header class="topbar">
      <div class="left-top">
        <input id="titleInput" class="title-input" placeholder="‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶∂‡¶ø‡¶∞‡ßã‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®..." />
        <button id="btnSettings" class="icon-btn" title="Settings">‚öô</button>
      </div>
      <div id="overallBox" class="card overall-box">
          <div class="overall-row">
            <div id="overallSummary" class="muted small">Overall Progress:</div>
            <div id="overallPct" class="big-pct">0%</div>
          </div>
          <div class="progress-wrap">
            <div id="overallBar" class="progress-bar"><div class="progress-fill" style="width:0%"></div></div>
          </div>
        </div>
      <div class="right-top">
        <button id="btnAddSubject" class="primary">Ôºã Subject</button>
        <button id="btnExport">Export</button>
        <button id="btnImport">Import</button>
        <input id="importFile" type="file" accept="application/json" style="display:none"/>
        <button id="btnClear" class="danger">Clear</button>
      </div>
    </header>
    <main class="main-full">
      <section id="subjectsContainer" class="subjects-container">
        <div class="empty-note">No subjects yet ‚Äî click "Ôºã Subject" to add one.</div>
      </section>
      <aside class="side-panel">
        <div id="settingsPanel" class="settings-panel hidden">
          <div class="settings-header">
            <h3>Settings</h3>
            <button id="closeSettings" class="icon-btn">‚úï</button>
          </div>
          <div class="settings-body">
            <div class="setting-row">
              <label>Overall progress mode</label>
              <select id="calcMode">
                <option value="chapters">A ‚Äî By chapter count (completed / total)</option>
                <option value="goals">B ‚Äî By goals (sum solved / sum goals)</option>
              </select>
            </div>
            <div class="setting-row">
              <label>Default subject color</label>
              <input id="defaultColor" type="color" />
            </div>
            <div class="setting-row">
              <label>Chapter color (0‚Äì33%)</label>
              <input id="colorLow" type="color" />
            </div>
            <div class="setting-row">
              <label>Chapter color (34‚Äì66%)</label>
              <input id="colorMid" type="color" />
            </div>
            <div class="setting-row">
              <label>Chapter color (67‚Äì99%)</label>
              <input id="colorHigh" type="color" />
            </div>
            <div class="setting-row">
              <label>Chapter color (100%)</label>
              <input id="colorFull" type="color" />
            </div>
            <div class="setting-row">
              <label>Chapter color intensity</label>
              <select id="colorIntensity">
                <option value="light">Light (good text contrast)</option>
                <option value="normal">Normal</option>
              </select>
            </div>
            <div style="margin-top:12px;display:flex;gap:8px;justify-content:flex-end">
              <button id="saveSettings" class="primary small">Save</button>
              <button id="resetColors" class="small">Reset</button>
            </div>
          </div>
        </div>
      </aside>
    </main>

    <!-- templates (not visible) -->
    <template id="subjectTpl">
      <div class="subject card">
        <div class="subject-header">
          <div class="left">
            <div class="color-picker-wrap">
              <input class="subject-color" type="color" title="Subject color"/>
            </div>
            <div class="subject-name name" contenteditable="true" spellcheck="false">‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶∑‡ßü</div>
          </div>
          <div class="right">
            <div class="subject-pct small muted">0%</div>
            <button class="add-part small">Ôºã Part</button>
            <button class="remove-subject small danger">Delete</button>
          </div>
        </div>

        <div class="subject-progress-wrap">
          <div class="subject-progress-bar"><div class="subject-progress-fill" style="width:0%"></div></div>
        </div>

        <div class="parts-row">
          <div class="part-col">
            <div class="part-header">
              <div class="part-name name" contenteditable="true" spellcheck="false">Part 1</div>
              <div class="part-actions">
                <button class="add-chapter small">Ôºã Chapter</button>
                <button class="remove-part small danger">Delete</button>
              </div>
            </div>
            <div class="chapters-list"></div>
          </div>
          <div class="part-col">
            <div class="part-header">
              <div class="part-name name" contenteditable="true" spellcheck="false">Part 2</div>
              <div class="part-actions">
                <button class="add-chapter small">Ôºã Chapter</button>
                <button class="remove-part small danger">Delete</button>
              </div>
            </div>
            <div class="chapters-list"></div>
          </div>
        </div>
      </div>
    </template>
<template id="chapterTpl">
  <div class="chapter-row">
    <!-- <div class="delete-swipe-btn" title="Swipe to delete">
        üóë
    </div> -->

    <div class="chapter-content">
      <input class="chap-check" type="checkbox" title="mark complete"/>
      <div class="chap-name name" contenteditable="true" spellcheck="false">Chapter</div>
      <div class="chap-goal small muted">Goal: <span class="goal-value">0</span></div>
      <div class="chap-solved small muted">Solved: <span class="solved-value">0</span>
      </div>
      <div class="chap-progress"><div class="fill" style="width:0%"></div><span>0%</span></div>
      <div class="chap-actions">
        <button class="del-ch small danger">X</button>
      </div>
    </div>
  </div>
</template>
  </div>
  <!-- <script src="app.js" defer></script> -->
   <script>
    (() => {
  /* ==================== Scroll Hide for Toolbar (Mobile Only) ==================== */
  /* ==================== Scroll Hide for Toolbar (Mobile Only) ==================== */
const topbar = document.querySelector('.topbar');
const rightTop = document.querySelector('.right-top');
const overallBox = document.getElementById('overallBox');
const titleInput = document.getElementById('titleInput');
const subjectsScroll = document.getElementById('subjectsContainer');

if (topbar && rightTop && overallBox && titleInput) {
  let lastScroll = 0;
  const THRESH = 25;

  const getScroll = () =>
    subjectsScroll && subjectsScroll.scrollHeight > subjectsScroll.clientHeight
      ? subjectsScroll.scrollTop
      : window.pageYOffset || document.documentElement.scrollTop || 0;

  function handleScroll() {
    if (window.innerWidth > 768) {
      // reset on desktop
      topbar.classList.remove('collapsed');
      rightTop.classList.remove('hide-toolbar');
      overallBox.classList.remove('hide-toolbar');
      titleInput.classList.remove('only-title');
      lastScroll = getScroll();
      return;
    }

    const current = getScroll();
    const diff = current - lastScroll;
    if (Math.abs(diff) < THRESH) return;

    if (diff > 0 && current > 50) {
      // scrolling down ‚Üí collapse all except title
      topbar.classList.add('collapsed');
      rightTop.classList.add('hide-toolbar');
      overallBox.classList.add('hide-toolbar');
      titleInput.classList.add('only-title');
    } else if (diff < 0) {
      // scrolling up ‚Üí expand everything
      topbar.classList.remove('collapsed');
      rightTop.classList.remove('hide-toolbar');
      overallBox.classList.remove('hide-toolbar');
      titleInput.classList.remove('only-title');
    }

    lastScroll = current;
  }

  window.addEventListener('scroll', handleScroll, { passive: true });
  if (subjectsScroll)
    subjectsScroll.addEventListener('scroll', handleScroll, { passive: true });

  window.addEventListener('resize', () => {
    lastScroll = getScroll();
    if (window.innerWidth > 768) {
      topbar.classList.remove('collapsed');
      rightTop.classList.remove('hide-toolbar');
      overallBox.classList.remove('hide-toolbar');
      titleInput.classList.remove('only-title');
    }
  });
}
/* ==================== END Scroll Hide ==================== */


  /* ==================== State and Storage ==================== */
  const LS_KEY = "study_progress_data_v7";
  let state = {
    title: "",
    subjects: [],
    settings: {
      mode: "chapters",
      defaultColor: "#dbeafe",
      colors: {
        low: "#fde8e8",
        mid: "#fff5cc",
        high: "#d7f7d7",
        full: "#a5f3a5",
      },
    },
  };
  let currentlySwipedRow = null; 

  const $ = (id) => document.getElementById(id);
  const subjectTpl = document.getElementById("subjectTpl");
  const chapterTpl = document.getElementById("chapterTpl");
  const subjectsContainer = $("subjectsContainer");

  const idGen = (p = "id") => `${p}_${Date.now()}_${Math.floor(Math.random() * 9999)}`;
  const chapterCompleted = (ch) => ch.goal > 0 && ch.solved >= ch.goal;


  function colorForPercent(p) {
    const c = state.settings.colors;
    if (p >= 100) return c.full;
    if (p >= 67) return c.high;
    if (p >= 34) return c.mid;
    return c.low;
  }

  /* ==================== Save Indicator ==================== */
  const saveIndicator = (() => {
    const el = document.createElement("div");
    el.id = "saveIndicator";
    el.textContent = "üíæ Saved";
    document.body.appendChild(el);
    return {
      show() {
        el.classList.add("visible");
        clearTimeout(el._timer);
        el._timer = setTimeout(() => el.classList.remove("visible"), 1500);
      },
    };
  })();

  function save() {
    localStorage.setItem(LS_KEY, JSON.stringify(state));
    saveIndicator.show();
  }

  function load() {
    try {
      const raw = localStorage.getItem(LS_KEY);
      if (raw) state = JSON.parse(raw);
    } catch (e) {
      console.warn("Load error:", e);
    }
  }

  /* ==================== Calculations ==================== */
  function subjectPercent(subj) {
    const chapters = subj.parts.flatMap(p => p.chapters);
    if (!chapters.length) return 0;
    const done = chapters.filter(chapterCompleted).length;
    return Math.round((done / chapters.length) * 100);
  }

  function overallStats() {
    const chapters = state.subjects.flatMap(s => s.parts.flatMap(p => p.chapters));
    const total = chapters.length;
    const done = chapters.filter(chapterCompleted).length;
    const pct = total ? Math.round((done / total) * 100) : 0;
    return { pct, summary: `Completed ${done}/${total} chapters` };
  }

  function playSound(audio) {
            audio.valume = 0.8;
            audio.pause();
            audio.currentTime = 0;
            audio.play().catch(e => console.warn("Audio playback blocked:", e)); 
          }
          
  /* ==================== Rendering ==================== */
  function render() {
    subjectsContainer.innerHTML = "";

    if (!state.subjects.length) {
      subjectsContainer.innerHTML = `<div class="empty-note">No subjects yet ‚Äî click "Ôºã Subject" to add one.</div>`;
      updateOverall();
      return;
    }

    state.subjects.forEach((subj) => {
      const node = subjectTpl.content.cloneNode(true);
      const sEl = node.querySelector(".subject");
      const header = sEl.querySelector(".subject-header");

      // Subject color
      header.style.background = subj.color || state.settings.defaultColor;

      // Subject name
      const nameEl = sEl.querySelector(".subject-name");
      nameEl.textContent = subj.name || "New Subject";
      nameEl.addEventListener("keydown", (e) => {
        if (e.key === "Enter") e.preventDefault(), nameEl.blur();
      });
      nameEl.addEventListener("blur", () => {
        subj.name = nameEl.textContent.trim();
        save();
      });

      // Color picker
      const colorInp = sEl.querySelector(".subject-color");
      colorInp.value = subj.color || state.settings.defaultColor;
      colorInp.addEventListener("input", (e) => {
        header.style.background = e.target.value;
      });
      colorInp.addEventListener("change", (e) => {
        subj.color = e.target.value;
        save();
        render();
      });

      // Progress
      const spct = subjectPercent(subj);
      const fill = sEl.querySelector(".subject-progress-fill");
      fill.style.width = spct + "%";
      fill.style.background = "#60a5fa";
      sEl.querySelector(".subject-pct").textContent = spct + "%";

      // Add & remove part
      sEl.querySelector(".add-part").onclick = () => {
        subj.parts.push({ id: idGen("part"), name: "New Part", chapters: [] });
        save();
        render();
      };
      sEl.querySelector(".remove-subject").onclick = () => {
        if (!confirm("Delete this subject?")) return;
        state.subjects = state.subjects.filter(x => x.id !== subj.id);
        save();
        render();
      };

      // Parts
      const partsRow = sEl.querySelector(".parts-row");
      partsRow.innerHTML = "";
      subj.parts.forEach((part, pIdx) => {
        const col = document.createElement("div");
        col.className = "part-col";

        const pHeader = document.createElement("div");
        pHeader.className = "part-header";
        const pName = document.createElement("div");
        pName.className = "part-name";
        pName.textContent = part.name;
        pName.contentEditable = true;
        pName.addEventListener("keydown", (e) => {
          if (e.key === "Enter") e.preventDefault(), pName.blur();
        });
        pName.addEventListener("blur", () => {
          part.name = pName.textContent.trim();
          save();
        });

        const pActions = document.createElement("div");
        pActions.className = "part-actions";
        const addCh = document.createElement("button");
        addCh.textContent = "+ Chapter";
        addCh.className = "small";
        addCh.onclick = () => {
          part.chapters.push({
            id: idGen("chap"),
            name: "New Chapter",
            goal: 100,
            solved: 0,
            checked: false,
          });
          save();
          render();
        };
        const delPart = document.createElement("button");
        delPart.textContent = "Delete";
        delPart.className = "small danger";
        delPart.onclick = () => {
          if (!confirm("Delete this part?")) return;
          subj.parts.splice(pIdx, 1);
          save();
          render();
        };
        pActions.append(addCh, delPart);
        pHeader.append(pName, pActions);
        col.appendChild(pHeader);

        const chList = document.createElement("div");
        chList.className = "chapters-list";
        part.chapters.forEach((ch, cIdx) => {
          const crow = chapterTpl.content.cloneNode(true);
          const row = crow.querySelector(".chapter-row");

          // const p = ch.goal ? Math.round((ch.solved / ch.goal) * 100) : 0;
            const p = ch.goal ? parseFloat(((ch.solved / ch.goal) * 100).toFixed(2)) : 0;

          row.style.background = colorForPercent(p);

          const chk = row.querySelector(".chap-check");
          chk.checked = !!ch.checked;
          chk.onchange = () => {
            ch.checked = chk.checked;
            if (chk.checked) {
              ch.solved = ch.goal;
              playSound( new Audio('positive.wav'));
            }
            else ch.solved = 0;
            save();
            render();
          };

          const cname = row.querySelector(".chap-name");
          cname.textContent = ch.name;
          cname.addEventListener("keydown", (e) => {
            if (e.key === "Enter") e.preventDefault(), cname.blur();
          });
          cname.addEventListener("blur", () => {
            ch.name = cname.textContent.trim();
            save();
          });

          const goalSpan = row.querySelector(".goal-value");
          goalSpan.textContent = ch.goal || 0;
          goalSpan.addEventListener("dblclick", () => {
            const val = prompt("Set new goal:", ch.goal);
            if (val === null) return;
            const n = parseInt(val);
            if (!isNaN(n)) {
              ch.goal = n;
              if (ch.solved > ch.goal) ch.solved = ch.goal;
              save();
              render();
            }
          });



          let touchTimer;
          let touchTimer2;
          goalSpan.addEventListener('dblclick', () => openGoalPrompt());
          goalSpan.addEventListener('contextmenu', e => {
            e.preventDefault();
            openGoalPrompt();
          });
          goalSpan.addEventListener('touchstart', () => {
            touchTimer = setTimeout(() => openGoalPrompt(), 800);
          });
          goalSpan.addEventListener('touchend', () => clearTimeout(touchTimer));
          goalSpan.addEventListener('touchmove', () => clearTimeout(touchTimer));
          goalSpan.addEventListener('touchcancel', () => clearTimeout(touchTimer));

          function openGoalPrompt() {
            const val = prompt("Set goal (e.g. 100 MCQs)", ch.goal || 0);
            if (val === null) return;
            const n = parseInt(val);
            if (!isNaN(n)) {
              ch.goal = n;
              if (ch.solved > ch.goal) ch.solved = ch.goal;
              if (ch.solved >= ch.goal) ch.checked = true;
              goalSpan.textContent = ch.goal;
              save();
              render();
            }
          }
          const prog = row.querySelector(".chap-progress .fill");
          prog.style.width = p + "%";
          prog.style.background = "#60a5fa";
          row.querySelector(".chap-progress span").textContent = p + "%";

          const solvedSpan = row.querySelector(".solved-value");
          solvedSpan.textContent = ch.solved;          
          const incBtn = document.createElement("button");
          incBtn.textContent = "Ôºã";
          incBtn.className = "solved-inc small";
          
          solvedSpan.addEventListener('contextmenu', e => {
            e.preventDefault();
          });

          solvedSpan.addEventListener('touchstart', () => {
            touchTimer2 = setTimeout(() => openSolvedPrompt(), 800);
          });
          solvedSpan.addEventListener('touchend', () => clearTimeout(touchTimer2));
          solvedSpan.addEventListener('touchmove', () => clearTimeout(touchTimer2));
          solvedSpan.addEventListener('touchcancel', () => clearTimeout(touchTimer2));
          

          function openSolvedPrompt() {
            const val = prompt("Set solved (e.g. 100 MCQs)", ch.solved || 0);
            if (val === null) return;
            const n = parseInt(val);
            if (!isNaN(n)) {
              ch.solved = n;
              if (ch.solved > ch.goal) ch.solved = ch.goal;
              if (ch.solved >= ch.goal) {
                ch.checked = true;
                playSound(new Audio('positive.wav'));
              }
              solvedSpan.textContent = ch.solved;
              save();
              render();
            }
          }
          incBtn.onclick = () => {
            ch.solved++;
            if (ch.solved > ch.goal) ch.solved = ch.goal;

          
            // Add animation class
            incBtn.classList.add("animate");

            // Remove class after animation ends
            incBtn.addEventListener("animationend", () => {
              incBtn.classList.remove("animate");
            }, { once: true });

            // Delay render slightly so animation is visible
            setTimeout(() => {
              save();
              render();
              playSound(new Audio('correct.wav'));
            }, 300); // match your CSS animation duration

          };


          const decBtn = document.createElement("button");
          decBtn.textContent = "‚àí";
          decBtn.className = "solved-dec small";
          decBtn.onclick = () => {
            ch.solved = Math.max(0, ch.solved - 1);
            save();
            render();
          };

          row.querySelector(".chap-solved").append(incBtn, decBtn);
          
          row.querySelector(".del-ch").onclick = () => {
            if (!confirm("Delete this chapter?")) return;
            part.chapters.splice(cIdx, 1);
            save();
            render();
          };


          chList.appendChild(row);
        });

        col.appendChild(chList);
        partsRow.appendChild(col);
      });

      sEl.appendChild(partsRow);
      subjectsContainer.appendChild(sEl);
    });

    updateOverall();
  }
  // render finish ===============



  function updateOverall() {
    const { pct, summary } = overallStats();
    $("overallPct").textContent = pct + "%";
    $("overallBar").querySelector(".progress-fill").style.width = pct + "%";
    $("overallSummary").textContent = summary;
  }

  /* ==================== Buttons ==================== */
  $("btnAddSubject").onclick = () => {
    const subj = {
      id: idGen("subj"),
      name: "New Subject",
      color: state.settings.defaultColor,
      parts: [
        { id: idGen("part"), name: "Part 1", chapters: [] },
        { id: idGen("part"), name: "Part 2", chapters: [] },
      ],
    };
    state.subjects.push(subj);
    save();
    render();
  };

  $("btnClear").onclick = () => {
    if (!confirm("Clear all data?")) return;
    state.subjects = [];
    save();
    render();
  };

  $("btnExport").onclick = () => {
    const data = JSON.stringify(state, null, 2);
    const blob = new Blob([data], { type: "application/json" });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "study_progress.json";
    a.click();
    URL.revokeObjectURL(url);
  };

  $("btnImport").onclick = () => $("importFile").click();
  $("importFile").onchange = (e) => {
    const f = e.target.files[0];
    if (!f) return;
    const reader = new FileReader();
    reader.onload = (ev) => {
      try {
        const parsed = JSON.parse(ev.target.result);
        if (!confirm("Importing will replace your current data. Continue?")) return;
        state = parsed;
        save();
        render();
        $("titleInput").value = state.title || "";
      } catch {
        alert("Invalid JSON file");
      }
    };
    reader.readAsText(f);
  };

  /* ==================== Title Save ==================== */
  $("titleInput").addEventListener("blur", () => {
    state.title = $("titleInput").value.trim();
    save();
  });

  /* ==================== Init ==================== */
  load();
  $("titleInput").value = state.title || "";
  render();
})();

   </script>
  </body>
</html>
